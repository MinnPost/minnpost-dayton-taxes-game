<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>MinnPost</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
<link rel="shortcut icon" href="http://www.minnpost.com//sites/default/themes/siteskin/favicon.ico" type="image/x-icon" />
<meta name="keywords" content="Mark Dayton,Minnesota DFL,Minnesota GOP,Minnesota Legislature,Vikings Stadium,Voter ID Amendment" />
<meta name="description" content="  " />
<meta property="og:title" content="The 2012 Legislative session: What did they pass?"/>
<meta property="og:site_name" content="MinnPost"/>
<meta property="og:description" content="Explore bills by category, investigate which bills Gov. Dayton vetoed, and search by your legislators.
"/>
<meta property="og:image" content="http://www.minnpost.com/sites/default/files/images/thumbnails/fullpagearticles/BillExplorerGraphic3.png"/>
<link rel="apple-touch-icon" href="http://www.minnpost.com//sites/default/themes/siteskin/inc/images/apple-touch-icon.png" />
<meta name="viewport" content="width=device-width, initial-scale=1"></meta>


  <link type="text/css" rel="stylesheet" media="all" href="http://www.minnpost.com/sites/default/files/css/css_cc2732a55db9703697ac738883d915c9.css" />
<link type="text/css" rel="stylesheet" media="screen" href="http://www.minnpost.com/sites/default/files/css/css_b26ad2d81bc74f1246e9c9a4c45ecdea.css" />
<link type="text/css" rel="stylesheet" media="print" href="http://www.minnpost.com/sites/default/files/css/css_cd72d16d00ebb27825710d934e28fbe8.css" />
  <!--[if IE]>
      <link rel="stylesheet" href="http://www.minnpost.com/sites/default/themes/derma/inc/css/ie.css?n" type="text/css">
  <![endif]-->
    

</head>
<body class="not-front logged-in page-node node-type-article one-sidebar sidebar-right admin-nw admin-vertical admin-df  section-data section-data-id-2012 section-data-id-2012-id-05 section-data-id-2012-id-05-how-we-built-legislative-bill-explorer one-sidebar sidebar-right">
<div class="outside-embeddable-container">



  <!-- START: Embeddable -->
  <div class="node-body fieldlayout node-field-body">
    <style type="text/css">
      @import url('https://s3.amazonaws.com/data.minnpost/js/flurid-2.1/flurid.min.css');
      @import url('https://s3.amazonaws.com/data.minnpost/js/qtip2-master-20121022/jquery.qtip.min.css');
      @import url('https://s3.amazonaws.com/data.minnpost/js/jquery-no-ui-slider-2.5.5/nouislider.css');
    </style>
    <style type="text/css">
      #minnpost-dayton-taxes-game {
        max-width: 960px;
        margin: 0 auto;
        padding-top: 1em;
      }
      .clear {
        clear: both;
      }
      .js-dependent,
      .hidden {
        display: none;
      }
      .footnote {
        font-size: .75em;
        font-style: italic;
        color: #414141;
        margin-top: 3em;
        border-top: 1px solid #BCBCBC;
        padding-top: 1em;
      }
      .loading-general {
        width: 100%;
        text-align: center;
        padding: 2em 2em;
        color: #ABABAB;
        vertical-align: middle;
        height: 100%;
        line-height: 100%;
      }
      .loading-general span {
        padding: 10px 5px 10px 40px;
        background: transparent url('https://s3.amazonaws.com/data.minnpost/projects/2012-mn-election-results/images/ajax-loader.gif') center left no-repeat;
        vertical-align: middle;
        height: 100%;
        line-height: 100%;
      }
      
      
      #minnpost-dayton-taxes-game .number {
        font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
      }
      
      #minnpost-dayton-taxes-game .positive {
        color: #5CA36F;
      }
      
      #minnpost-dayton-taxes-game .negative {
        color: #B01C2A;
      }
      
      .tax-rate-container {
        text-align: center;
        margin: 1em 0 2em 0;
      }
      
      .tax-rate-value-label-container,
      .slider-container,
      .tax-rate-value {
        display:-moz-inline-stack;
        display:inline-block;
        zoom:1;
        *display:inline;
      }
      
      .slider-container {
        width: 40%;
      }
      #tax-rate-slider {
        position: relative;
        width: 99%;
        margin-bottom: 1.5em;
      }
      
      .tax-rate-value-label-container {
        margin-right: 1em;
      }
      
      .tax-rate-value-label {
        font-size: 1.5em;
        line-height: 1.25em;
        text-transform: uppercase;
        color: #878787;
      }
      
      .tax-rate-value {
        font-size: 2em;
        margin-left: 1em;
        text-align: left;
        width: 4em;
        top: -.5em;
        position: relative;
      }
      
      #tax-rate-slider .noUi-midBar {
        background: #5CA36F;
        background: -webkit-linear-gradient(top, #5CA36F, #6CAC7D);
        background: -moz-linear-gradient(top, #5CA36F, #6CAC7D);
        background: linear-gradient(top, #5CA36F, #6CAC7D);
        border: 1px solid #5CA36F;
      }
      #tax-rate-slider .noUi-handle > div {
        -webkit-border-radius: 3px;
        -moz-border-radius: 3px;
        border-radius: 3px;
      }
      #tax-rate-slider .noUi-handle > div:hover,
      #tax-rate-slider .noUi-handle > div.noUi-activeHandle {
        border: 1px solid #B2B2B2;
        background-color: #D4D4D4;
        cursor: pointer;
      }
      
      #tax-rate-slider .noUi-handle > div {
        -webkit-border-radius: 3px;
        -moz-border-radius: 3px;
        border-radius: 3px;
      }
      
      .tax-options-selection-container {
        text-align: center;
        margin-bottom: 1em;
        text-transform: uppercase;
        font-weight: bold;
        color: #878787;
      }
      
      .tax-options-selection-container a {
      }
      
      .tax-options-container .cell-inner {
        padding: 2% 2%;
        cursor: pointer;
      }
      
      .tax-options-container .tax-option {
        font-size: .85em;
        padding: 2% 4%;
        background-color: #D4D4D4;
        opacity: 0.6;
        zoom: 1;
        filter: alpha(opacity = 60);
      }
      
      .tax-options-container .tax-option:hover {
        background-color: #BABABA;
      }
      /*
      .tax-options-container .tax-option.category-digital {
        background-color: #80C1EF;
      }
      .tax-options-container .tax-option.category-consumer {
        background-color: #8089EF;
      }
      .tax-options-container .tax-option.category-business {
        background-color: #AE80EF;
      }
      */
      
      .tax-options-container .tax-option.enabled {
        opacity: 1;
        filter: alpha(opacity = 100);
        zoom: 1;
      }
      
      .tax-options-container .more-info {
        width: 15px;
        height: 15px;
        margin-left: 5px;
        background: transparent url('https://s3.amazonaws.com/data.minnpost/projects/minnpost-dayton-taxes-game/images/MoreInfoIcon-light.png') top center no-repeat;
        display:-moz-inline-stack;
        display:inline-block;
        zoom:1;
        *display:inline;
      }
      
      .game-container-inner .total {
        margin-top: 2em;
        padding: .5em 0;
        text-align: center;
      }
      
      .game-container-inner .total.glued {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        border-top: 1px solid #C2C2C2;
        background-color: #F2F2F2;
        background-color: rgba(255, 255, 255, 0.85);
        -webkit-box-shadow: 0px 0px 3px 3px rgba(100, 100, 100, 0.4);
        -moz-box-shadow: 0px 0px 3px 3px rgba(100, 100, 100, 0.4);
        box-shadow: 0px 0px 3px 3px rgba(100, 100, 100, 0.4);
      }
      
      .game-container-inner .total .total-raised-container,
      .game-container-inner .total .total-diff-container {
        margin: 0 1em;
        display:-moz-inline-stack;
        display:inline-block;
        zoom:1;
        *display:inline;
      }
      
      .game-container-inner .total .total-raised,
      .game-container-inner .total .total-diff {
        font-size: 2em;
        line-height: 1.25em;
      }
      
      .game-container-inner .total-diff-label {
        color: #878787;
      }
      
      .more-info-container {
        padding: 3% 5%;
        font-size: 1.25em;
        line-height: 1.25em;
      }
      
      .more-info-container .examples {
        margin-top: 1em;
      }
      
      /**
       * Responsive creen size styles
       */
      @media screen and (max-width: 960px) {
      }
    </style>
    
    <!--[if lte IE 8]>
      <style type="text/css">
      </style>
    <![endif]-->
    
    <!--[if lte IE 7]>
      <style type="text/css">
        .ie-upgrade-note {
          font-size: 90%;
          background-color: #DCDCDC;
          border: 1px solid #A2A2A2;
          padding: 1em;
          margin: 1em 0 2em 0;
        }
        
        .game-container-inner .total.glued {
          background-color: #F2F2F2;
        }
      </style>
    <![endif]-->
    
    
    <!-- Initial HTML for application -->
    <div id="minnpost-dayton-taxes-game">
      <noscript>
        <p>This application requires Javascript which is used to make your web browser more interactive.  If this message does not go away, please consider enabling Javascript.  Here are <a href="http://www.enable-javascript.com/" target="_blank">instructions on how to enable JavaScript in your web browser</a>.</p>
      </noscript>
      
      <!--[if lte IE 7]>
        <div class="ie-upgrade-note">
          <h4>Consider upgrading your browser</h4>
          <p>Your <strong>Internet Browser</strong> is the application you use to navigate webpages on the internet.  You are currently using an older version of Internet Explorer.  This application may not be full-featured because you are using such an old browser.</p>
          
          <p><a href="http://browsehappy.com/" target="_blank">Click here to find out about upgrading to a newer browsers</a>.</p>
        
          <p>If you cannot install new applications on your computer (because it is not allowed at work, for example), consider using <a href="http://www.google.com/chromeframe" target="_blank">Google's Chrome Frame</a> for Internet Explorer.</p>
        </div>
      <![endif]-->
      
      <div id="game-container">
        
      </div>
      
      <div class="footnote">
        <p>Total dollar amounts are rounded to nearest thousands.  Data compiled from the <a href="http://www.revenue.state.mn.us/tax_reform/Documents/Sales%20Tax%20Reform%20Overview%2001.29.2013.pdf" target="_blank">Minnesota Department of Revenue</a>.  Code, techniques, and data on <a href="https://github.com/MinnPost/minnpost-dayton-taxes-game" target="_blank">Github</a>.</p>
      </div>
    </div>
    
    
    <!-- Templates to be used in client side processing. -->
    <script id="template-loading" type="text/template">
      <div class="loading-general-container">
        <div class="loading-general"><span>Loading...</span></div>
      </div>
    </script>
    
    <script id="template-game" type="text/template">
      <div class="game-container-inner">
        <div class="tax-rate-container">
          <div class="tax-rate-value-label-container">
            <div class="tax-rate-value-label">Tax rate:</div>
            <div><a href="#" class="tax-rate-current">Set to current rate</a></div>
          </div>
          <div class="slider-container">
            <div id="tax-rate-slider" class="noUiSlider"></div>
          </div>
          <div class="tax-rate-value number">5.5%</div>
        </div>
        
        <div class="tax-options-selection-container">
          <a href="#" class="tax-option-select-all">Select all</a> | 
          <a href="#" class="tax-option-select-none">Select none</a> | 
          <a href="#" class="tax-option-sort-amount">Sort by amount</a> | 
          <a href="#" class="tax-option-sort-title">Sort by title</a>
        </div>
        
        <div class="tax-options-container">
        </div>
        
        <div class="total-container">
          <div class="total">
            <div class="total-raised-container">
              <div class="total-diff-label">Total raised:</div>
              <div class="total-raised number"></div>
            </div>
            <div class="total-diff-container">
              <div class="total-diff-label">Difference from Dayton's budget proposal:</div>
              <div class="total-diff number"></div>
            </div>
          </div>
        </div>
      </div>
    </script>
    
    <script id="template-tax-options" type="text/template">
      <div class="flurid">
        <% var count = 0; for (var t in taxes) { if (taxes[t].title) { %>
          <% if (count % 4 === 0) { %>
            <div class="row">
          <% } %>
          
          <div class="column width_1/4 <% if (count % 4 === 3) { %>last<% } %>">
            <div class="cell-inner">
              <div class="tax-option <% if (taxes[t].category) { %>category-<%= taxes[t].category.toLowerCase() %><% } %> <% if (taxes[t].on) { %>enabled<% } %>" data-id="<%= taxes[t].id %>">
                <span class="tax-title"><%= taxes[t].title %></span>
                <% if (taxes[t].details || taxes[t].examples) { %>
                  <span class="more-info"  data-id="<%= taxes[t].id %>"></span>
                <% } %>
                
                <br />
                <span class="tax-option-amount number"><%= _.numCurrencyThousand(taxes[t].base) %></span>
              </div>
            </div>
          </div>
          
          <% if (count % 4 === 3) { %>
            </div>
          <% } %>
          <% count++; %>
        <% } } %>
      </div>
    </script>
    
    <script id="template-more-info" type="text/template">
      <div class="more-info-container">
        <% if (t.details) { %>
          <div class="details">
            <%= t.details %>
          </div>
        <% } %>
        
        <% if (t.examples) { %>
          <div class="examples">
            <h5>Examples</h5>
            <%= t.examples %>
          </div>
        <% } %>
      </div>
    </script>
    
    
    <!-- jQuery that is used on MinnPost site (ensures test environment) -->
    <script type="text/javascript">
      window.jQuery || document.write('<script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/jquery-1.3.2/jquery-1.3.2.min.js"><\/script>')
    </script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/jquery-custom-master-20120606/jquery-1.7.2.custom.min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/qtip2-master-20121022/jquerycustom.qtip.min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/underscore-1.4.4/underscore-min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/jquery-no-ui-slider-2.5.5/jquerycustom.nouislider.min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/tabletop-master-20121204/tabletop.min.js"></script>
    
    
    <script type="text/javascript">
      jQueryCustom.noConflict();
      
      // Add some utility functions to underscore
      _.mixin({
        numCommas: function(number) {
          number += '';
          var x = number.split('.');
          var x1 = x[0];
          var x2 = x.length > 1 ? '.' + x[1] : '';
          var rgx = /(\d+)(\d{3})/;
          while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
          }
          return x1 + x2;
        },
        roundThousand: function(number) {
          return Math.round(number / 1000) * 1000;
        },
        numCurrency: function(number) {
          return '$' + this.numCommas(number.toFixed(2));
        },
        numCurrencyThousand: function(number, type) {
          var prefix = '$';
          prefix = (type === 'positive') ? '+$' : (type === 'negative') ? '-$' : prefix;
          
          return prefix + this.numCommas(this.roundThousand(Math.abs(number)));
        },
        boolString: function(bool) {
          return (bool) ? 'true' : 'false';
        },
        stringBool: function(string) {
          return (string && string !== 'false') ? true : false;
        }
      });
    
      (function($, w, undefined) {
        var dataDir = 'https://s3.amazonaws.com/data.minnpost/projects/minnpost-dayton-taxes-game/data/';
        var spreadsheetID = '0Ata43HM8s_nadFNRa2dKbHZ1QzhleHJPMHNEeHQ2bVE';
        var idCounter = 1;
        var taxData;
        var taxRate = 0.055;
        var currentTotal = 952654499.95;
        var daytonTotal = 952654499.95;
        
        // Check if we are on localhost
        if (location.host.indexOf('localhost') > -1) {
          dataDir = './data/';
        }
        
        $(document).ready(function() {
          var templates = {
            loading: _.template($('#template-loading').html()),
            game: _.template($('#template-game').html()),
            taxOptions: _.template($('#template-tax-options').html()),
            moreInfo: _.template($('#template-more-info').html())
          };
          var $appContainer = $('#game-container');
          
          // Mark as loading
          $appContainer.html(templates.loading({}));
          
          // Calculate total
          var calculateTotal = function() {
            var total = 0;
            var diff = 0;
            var $diff = $('.total-diff');
            var type = null;
            
            _.each(taxData, function(d) {
              total += (d.on) ? d.base * taxRate : 0;
            });
            diff = total - daytonTotal;
            currentTotal = total;

            // Show total
            $('.total-raised').html(_.numCurrencyThousand(total));

            // Show diff
            if (diff.toFixed(2) == 0) {
              $diff.removeClass('positive').removeClass('negative');
            }
            else if (diff < 0) {
              $diff.removeClass('positive').addClass('negative');
              type = 'negative';
            }
            else {
              $diff.addClass('positive').removeClass('negative');
              type = 'positive';
            }
            $('.total-diff').html(_.numCurrencyThousand(diff, type));
            
            return total;
          };
          
          // Build slider function
          var updateTaxRates = function() {
            _.each(taxData, function(d) {
              $('.tax-option[data-id=' + d.id + '] .tax-option-amount').html(_.numCurrencyThousand(d.base * taxRate));
            });
          };
          
          // Display tax rate
          var displayTaxRate = function(fix) {
            fix = fix || 1;
            $('.tax-rate-value').html((taxRate * 100).toFixed(fix) + '%');
          };
          
          // Build slider function
          var buildSlider = function() {
            // This slider only uses integers.  So multiplying by ten.
            $('#tax-rate-slider').noUiSlider('init', {
              handles: 1,
              connect: 'lower',
              scale: [0, 150],
              start: taxRate * 1000,
              change: function(e) {
                var val = $(this).noUiSlider('value')[1];
                taxRate = (val / 1000);
                displayTaxRate();
              },
              end: function(e) {
                // Update tax amounts for each item and calculate total.
                updateTaxRates();
                calculateTotal();
              }
            });
          };
          
          // Handle events
          var handleEvents = function() {
            $('#game-container').on('click', '.tax-option', function(e) {
              e.preventDefault();
              var $this = $(this);
              var id = $this.attr('data-id');
              var taxOption = _.find(taxData, function(d) {
                return (d.id == id);
              });
              
              // Handle enabled
              $this.toggleClass('enabled');
              taxOption.on = (taxOption.on) ? false : true;
              
              calculateTotal();
            });
            
            $('.tax-rate-current').on('click', function(e) {
              e.preventDefault();
              // Stupid slider only handles integers
              $('#tax-rate-slider').noUiSlider('move', { knob: 0, to: 68.75 });
              taxRate = 0.06875;
              displayTaxRate(3);
              updateTaxRates();
              calculateTotal();
            });
            
            // More info events with qtip
            $('.more-info').qtip({
              content: function(e) {
                var id = $(this).attr('data-id');
                var taxOption = _.find(taxData, function(d) {
                  return (d.id == id);
                });
                
                return templates.moreInfo({ t: taxOption });
              },
              style: {
                classes: 'ui-tooltip-shadow ui-tooltip-light'
              },
              position: {
                at: 'bottom center',
                my: 'top center'
              }
            });
            
            // Select all or none links
            $('.tax-option-select-all').on('click', function(e) {
              e.preventDefault();
              
              taxData = _.map(taxData, function(d) {
                $('.tax-option[data-id=' + d.id + ']').addClass('enabled');
                d.on = true;
                return d;
              });
              calculateTotal();
            });
            
            // Select all or none links
            $('.tax-option-select-none').on('click', function(e) {
              e.preventDefault();
              
              taxData = _.map(taxData, function(d) {
                $('.tax-option[data-id=' + d.id + ']').removeClass('enabled');
                d.on = false;
                return d;
              });
              calculateTotal();
            });
            
            // Sort by amount
            $('.tax-option-sort-amount').on('click', function(e) {
              e.preventDefault();
              
              taxData = _.sortBy(taxData, function(d) { return d.base * -1; });
              $('.tax-options-container').html(templates.taxOptions({ taxes: taxData }));
              updateTaxRates();
              calculateTotal();
            });
            
            // Sort by title
            $('.tax-option-sort-title').on('click', function(e) {
              e.preventDefault();
              
              taxData = _.sortBy(taxData, function(d) { return d.title; });
              $('.tax-options-container').html(templates.taxOptions({ taxes: taxData }));
              updateTaxRates();
              calculateTotal();
            });
            
            // Fixed total thingy
            var $total = $('.total');
            var totalB = $total.offset().top + $total.outerHeight();
            $('.total-container').height($total.outerHeight());
            $(w).scroll(function() {
              var $this = $(this);
              var bottom = $this.scrollTop() + $this.height();
              
              // Add class for fixed menu
              if ((bottom < totalB) && !$total.hasClass('glued')) {
                $total.addClass('glued');
              }
              else if ((bottom >= totalB) && $total.hasClass('glued')) {
                $total.removeClass('glued');
              }
            });
            // Initial trigger
            $(w).scroll();
          };
          
          // Main function once data is loaded
          var buildGame = function(data, tabletop) {
            taxData = _.sortBy(data, function(d) { return d.base * -1; });
            
            $appContainer.html(templates.game({ }));
            $('.tax-options-container').html(templates.taxOptions({ taxes: taxData }));
            buildSlider();
            
            // Get total and store, then use that to find diff
            daytonTotal = calculateTotal();
            calculateTotal();
            updateTaxRates();
            
            handleEvents();
          };
          
          // Get data from spreadsheet
          Tabletop.init({
            key: spreadsheetID,
            simpleSheet: true,
            callback: buildGame,
            postProcess: function(row) {
              row.base = parseFloat(row.base);
              row.id = idCounter;
              row.on = true;
              
              idCounter++;
            }
          });
        });
      })(jQueryCustom, window);
    </script>
  </div>
  <!-- END: Embeddable -->



</div>
</body>
</html>